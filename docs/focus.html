<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroFocus</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif; background: linear-gradient(180deg, #0a0e27 0%, #1a1f3a 50%, #0f2a3d 100%); color: #e0e0e0; min-height: 100vh; position: relative; overflow-x: hidden; }
        body::before { content: ''; position: fixed; top: 40%; left: 30%; width: 1200px; height: 1200px; background: radial-gradient(circle, rgba(200, 0, 255, 0.25) 0%, rgba(200, 0, 255, 0.12) 40%, transparent 70%); border-radius: 50%; filter: blur(100px); pointer-events: none; z-index: 0; transform: translate(calc(-50% + var(--blob-offset-x, 0px)), calc(-50% + var(--blob-offset-y, 0px))); transition: transform 0.1s ease-out; }
        html { scroll-behavior: smooth; scroll-snap-type: y mandatory; }
        .container { max-width: 960px; margin: 0 auto; padding: 32px; }
        .screen { display: none; }
        .screen.active { display: block; }
        #profile-screen.active { display: flex; flex-direction: column; }
        #profile-screen { width: 100%; }
        h1 { font-size: 40px; font-weight: 600; margin-bottom: 16px; color: #fff; }
        h2 { font-size: 28px; font-weight: 600; margin-bottom: 16px; color: #fff; }
        h3 { font-size: 20px; font-weight: 500; margin-bottom: 12px; color: #fff; }
        p { font-size: 16px; line-height: 1.6; color: #b0b0b0; margin-bottom: 12px; }
        .card { background: rgba(30, 40, 70, 0.6); border-radius: 24px; padding: 32px; margin-bottom: 24px; border: 1px solid rgba(100, 150, 200, 0.1); position: relative; z-index: 1; }
        .btn { padding: 14px 32px; font-size: 16px; font-weight: 500; border-radius: 12px; border: none; cursor: pointer; transition: all 0.3s; position: relative; z-index: 1; }
        .btn-primary { background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%); color: #fff; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0, 212, 255, 0.4); }
        .subject-selector { display: flex; flex-direction: column; gap: 16px; margin: 24px 0; }
        .subject-card { background: rgba(40, 50, 80, 0.5); border: 2px solid rgba(100, 150, 200, 0.2); border-radius: 16px; padding: 20px; cursor: pointer; transition: all 0.3s; }
        .subject-card:hover { border-color: rgba(0, 212, 255, 0.5); background: rgba(40, 50, 80, 0.7); }
        .subject-card.selected { border-color: #00d4ff; background: rgba(0, 212, 255, 0.1); }
        .subject-label { font-size: 18px; font-weight: 500; color: #fff; }
        #loading-screen.active { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; text-align: center; }
        .waveform { width: 200px; height: 200px; border-radius: 50%; background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(150, 0, 255, 0.2) 100%); animation: pulse 2s ease-in-out infinite; margin: 32px auto; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 0.6; } 50% { transform: scale(1.1); opacity: 1; } }
        .progress-bar { width: 300px; height: 4px; background: rgba(100, 100, 150, 0.3); border-radius: 2px; margin: 24px auto; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00d4ff 0%, #9000ff 100%); width: 0%; transition: width 0.3s; }
        .loading-title { font-size: 24px; color: #00d4ff; margin-top: 16px; }
        .flip-card { perspective: 1000px; height: 400px; cursor: pointer; }
        .flip-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
        .flip-card-front, .flip-card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: space-between; text-align: center; padding: 32px; background: rgba(30, 40, 70, 0.6); border-radius: 24px; border: 1px solid rgba(100, 150, 200, 0.1); }
        .flip-card-back { transform: rotateY(180deg); background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(150, 0, 255, 0.1) 100%); }
        .flip-hint { font-size: 14px; color: #808080; }
        .chart-container { margin: 24px 0; min-height: 500px; }
        .chart-container-full { margin: 0; height: 100%; }
        .track-detail-container { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin: 24px 0; }
        .track-detail-container-full { display: grid; grid-template-columns: 2fr 1fr; grid-template-rows: 1fr 1fr; gap: 12px; margin: 0; height: calc(100vh - 200px); }
        .detail-panel { background: rgba(40, 50, 80, 0.5); border-radius: 16px; padding: 24px; min-height: 400px; }
        .detail-panel-full { background: rgba(40, 50, 80, 0.5); border-radius: 16px; padding: 20px; display: flex; flex-direction: column; }
        .track-info-panel { background: rgba(40, 50, 80, 0.5); border-radius: 16px; padding: 20px; height: 100%; overflow-y: auto; }
        .track-info-item { margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(100, 150, 200, 0.1); }
        .track-info-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .track-info-label { font-size: 11px; color: #808080; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 2px; }
        .track-info-value { font-size: 14px; color: #fff; font-weight: 500; }
        .full-page-section { width: 100%; min-height: 100vh; display: flex; align-items: center; justify-content: center; scroll-snap-align: start; scroll-snap-stop: always; padding: 20px; }
        #section-3-4 { padding: 20px; }
        .section-content { width: 100%; max-width: 1200px; }
        .section-content h2 { margin-bottom: 24px; }
        .section-content p { margin-bottom: 24px; }
        .placeholder-message { display: flex; align-items: center; justify-content: center; height: 100%; color: #808080; font-style: italic; }
        #wave-canvas { display: block; width: 100%; max-width: 720px; height: auto; border-radius: 8px; background: rgba(20,30,50,0.3); margin: 0 auto; }
        .wave-legend { display: none; gap: 16px; flex-wrap: wrap; justify-content: center; margin-top: 12px; font-size: 13px; color: #b0b0b0; }
        .wave-legend span { display: flex; align-items: center; gap: 6px; }
        .wave-legend .swatch { width: 20px; height: 3px; border-radius: 2px; display: inline-block; }
        #wave-placeholder { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        #wave-placeholder.hidden { display: none; }
        #track-detail { position: relative; }
        .session-section { margin: 32px 0; }
        .button-group { display: flex; gap: 16px; margin-top: 32px; }
        .text-center { text-align: center; }
        .mt-4 { margin-top: 32px; }
        @media (max-width: 768px) { .track-detail-container { grid-template-columns: 1fr; } .button-group { flex-direction: column; } }
    </style>
</head>
<body>
    <div id="start-screen" class="screen active">
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 40px 20px;">
            <div class="card text-center" style="max-width: 500px;">
                <h1>Find Your Focus Profile</h1>
                <p>Discover how different music genres and tempos affect your brain's focus patterns.</p>
                <div class="subject-selector">
                    <div class="subject-card" onclick="selectSubject('P01')">
                        <input type="radio" name="subject" id="subject-p01" value="P01">
                        <label for="subject-p01" class="subject-label">36F previous musician</label>
                    </div>
                    <div class="subject-card" onclick="selectSubject('P05')">
                        <input type="radio" name="subject" id="subject-p05" value="P05">
                        <label for="subject-p05" class="subject-label">22M turntable music enthusiast</label>
                    </div>
                    <div class="subject-card" onclick="selectSubject('P07')">
                        <input type="radio" name="subject" id="subject-p07" value="P07">
                        <label for="subject-p07" class="subject-label">24F keyboardist</label>
                    </div>
                    <div class="subject-card" style="opacity: 0.5; cursor: not-allowed;">
                        <label class="subject-label">Upload your own EEG (coming soon...)</label>
                    </div>
                </div>
                <button class="btn btn-primary mt-4" onclick="startAnalysis()" id="analyze-btn" disabled>Analyze This Brain</button>
            </div>
        </div>
    </div>

    <div id="loading-screen" class="screen">
        <div style="width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 32px;">
            <canvas id="loading-waveform" width="1200" height="200" aria-label="Loading waveform" style="width: 100%; max-width: 1200px; height: auto;"></canvas>
            <h2 class="loading-title" id="loading-title">Sampling Chim Chim Cheree...</h2>
        </div>
    </div>

    <div id="profile-screen" class="screen">
        <!-- Section 3.1: Flip Card -->
        <section class="full-page-section" id="section-3-1">
            <div class="section-content">
                <div class="flip-card" id="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <div>
                                <h2>Among the 12 clips and 3 genres…</h2>
                                <p>Discover your unique focus profile</p>
                            </div>
                            <div class="flip-hint">
                                <div>Scroll to reveal</div>
                                <div style="font-size: 20px; margin-top: 8px;">↓</div>
                            </div>
                        </div>
                        <div class="flip-card-back">
                            <div>
                                <h2>Your Focus Profile</h2>
                                <p id="best-genre-text">Based on your brain's response to music</p>
                            </div>
                            <div class="flip-hint">
                                <div>Continue scrolling</div>
                                <div style="font-size: 20px; margin-top: 8px;">↓</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3.2: Tempo Chart (moved before Genre) -->
        <section class="full-page-section" id="section-3-2">
            <div class="section-content">
                <h2>Your Focus Tempo</h2>
                <p id="tempo-description">Exploring how different tempos affect your focus...</p>
                <div id="tempo-chart" class="chart-container"></div>
            </div>
        </section>

        <!-- Section 3.3: Genre Scatter (moved after Tempo) -->
        <section class="full-page-section" id="section-3-3">
            <div class="section-content">
                <h2>How Each Genre Supports Your Focus</h2>
                <p>Right = higher Focus Index · Up = more stable focus over time</p>
                <div id="genre-scatter" class="chart-container"></div>
            </div>
        </section>

        <!-- Section 3.4: Track Map & Waves -->
        <section class="full-page-section" id="section-3-4">
            <div class="section-content">
                <h2>Focus per Track</h2>
                <div class="track-detail-container-full">
                    <!-- Row 1: Track Map (spans both columns) -->
                    <div class="detail-panel-full" style="grid-column: 1 / 3;">
                        <h3>Track Map</h3>
                        <div id="track-scatter" class="chart-container-full"></div>
                    </div>
                    
                    <!-- Row 2 Left: Focus Waves -->
                    <div class="detail-panel-full">
                        <h3>Focus Waves</h3>
                        <div id="track-detail" style="height: 100%; display: flex; flex-direction: column;">
                            <canvas id="wave-canvas" width="720" height="200" aria-label="Focus waves" style="flex: 1;"></canvas>
                            <div class="wave-legend" id="wave-legend"></div>
                            <div class="placeholder-message" id="wave-placeholder">Click a track on the map to see its focus wave.</div>
                        </div>
                    </div>
                    
                    <!-- Row 2 Right: Track Info -->
                    <div class="track-info-panel">
                        <div id="track-info-container">
                            <p style="color: #808080; font-style: italic;">Click a track to view details</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Button pushed below viewport -->
        <section class="full-page-section">
            <div style="display: flex; align-items: center; justify-content: center;">
                <button class="btn btn-primary" onclick="navigateTo('session')">See What This Means for Your Work</button>
            </div>
        </section>
    </div>

    <div id="session-screen" class="screen">
        <div class="container">
            <div class="card">
                <h1>Focus Summary</h1>
                <p>Based on your brain's response to 12 music clips across 3 genres and various tempo ranges...</p>
                <div class="session-section">
                    <h3>For Deep Focus</h3>
                    <p id="deep-focus-text">Classical clips had the strongest, most stable Focus Index...</p>
                </div>
                <div class="session-section">
                    <h3>For Breaks and Energizing</h3>
                    <p id="break-text">Lyrics had the lowest focus index and the most jittery responses...</p>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="navigateTo('profile')">Back to Focus Profile</button>
                    <button class="btn btn-primary" onclick="navigateTo('start')">Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <script src="focus.js"></script>
</body>
</html>